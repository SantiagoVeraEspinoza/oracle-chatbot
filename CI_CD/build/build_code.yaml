version: 0.1
component: build
timeoutInSeconds: 10000
shell: bash
failImmediatelyOnError: true

steps:
  - type: Command
    name: "ResolveDependencies"
    timeoutInSeconds: 600
    command: |
      java -version
      yum install -y java-11-openjdk-devel
      which java
      ls -l /usr/bin/java
      alternatives --display java
      JAVA_11_PATH=$(alternatives --query java | grep Alternative: | grep java-11 | awk '{print $2}')
      alternatives --set java "$JAVA_11_PATH"
      java -version

  - type: Command
    name: "BuildAndPackage"
    timeoutInSeconds: 600
    command: |
      cd MtdrSpring/backend/
      mvn clean package spring-boot:repackage
      echo "Created build successfully"

  - type: Command
    name: "GenerateImage"
    timeoutInSeconds: 600
    command: |
      docker build -f Dockerfile -t qro.ocir.io/axyjxetlpn8q/reacttodo/ga2ht/todolistapp-springboot:0.1 .

outputArtifacts:
  - name: MyTodoListAppImage
    type: DOCKER_IMAGE
    location: qro.ocir.io/axyjxetlpn8q/reacttodo/ga2ht/todolistapp-springboot:0.1
